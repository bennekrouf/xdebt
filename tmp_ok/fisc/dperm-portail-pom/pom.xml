<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
	<modelVersion>4.0.0</modelVersion>
	<parent>
		<groupId>org.springframework.boot</groupId>
		<artifactId>spring-boot-starter-parent</artifactId>
		<version>2.3.12.RELEASE</version>
	</parent>

	<groupId>ch.vd.fiscalite</groupId>
	<artifactId>dperm-portail-pom</artifactId>
	<version>23R2.C.1-SNAPSHOT</version>
	<packaging>pom</packaging>
	<name>dperm-portail-pom</name>

	<scm>
		<url>https://portail.etat-de-vaud.ch/outils/git/projects/FISC/repos/dperm-portail-pom/browse</url>
		<connection>scm:git:ssh://git@bitbucket.etat-de-vaud.ch/fisc/dperm-portail-pom.git</connection>
		<developerConnection>scm:git:ssh://git@bitbucket.etat-de-vaud.ch/fisc/dperm-portail-pom.git</developerConnection>
		<tag>${project.artifactId}-${project.version}</tag>
	</scm>

	<ciManagement>
		<system>Jenkins CI</system>
		<url>https://validation.portail.etat-de-vaud.ch/outils/jenkins-fisc/job/dperm-portail-pom/</url>
	</ciManagement>

	<developers>
		<developer>
			<id>p3wany</id>
			<name>Francois Achache</name>
		</developer>
	</developers>

	<distributionManagement>
        <repository>
            <id>nexus.releases</id>
            <name>Nexus releases</name>
            <url>${nexus.url.releases}</url>
        </repository>
        <snapshotRepository>
            <id>nexus.snapshots</id>
            <name>Nexus snaphots</name>
            <url>${nexus.url.snapshots}</url>
            <uniqueVersion>false</uniqueVersion>
        </snapshotRepository>
    </distributionManagement>

	<properties>
		<maven.compiler.source>11</maven.compiler.source>
		<maven.compiler.target>11</maven.compiler.target>
		<maven.javadoc.skip>true</maven.javadoc.skip>
		<!-- COMMONS -->
		<packaging.type>war</packaging.type>
		<endorsed.dir>${project.build.directory}/endorsed</endorsed.dir>
		<project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
		<server.ctx>dpermservicesIN</server.ctx> <!-- Ceci sert pour la récupération des fichiers de config via GIT-->
		<site.path>../${project.artifactId}-ihm/target/site</site.path>
		<log.appender>FILE</log.appender>
		<maven-release-plugin.version>3.0.0-M1</maven-release-plugin.version>
		<maven-failsafe-plugin.version>3.0.0-M4</maven-failsafe-plugin.version>
		<maven-surefire-plugin.version>3.0.0-M4</maven-surefire-plugin.version>
		<maven-war-plugin.version>3.2.3</maven-war-plugin.version>
		<spring-framework.version>5.2.22.RELEASE</spring-framework.version>

		<open-api.version>1.2.34</open-api.version>
		<log4j2.version>2.17.1</log4j2.version>
	</properties>

	<dependencyManagement>
		<dependencies>
			<dependency>
				<groupId>org.springdoc</groupId>
				<artifactId>springdoc-openapi-ui</artifactId>
				<version>${open-api.version}</version>
			</dependency>
		</dependencies>
	</dependencyManagement>

	<profiles>
		<profile>
			<id>release-profile</id>
			<build>
				<plugins>
					<plugin>
						<artifactId>maven-deploy-plugin</artifactId>
						<configuration>
							<skip>false</skip>
						</configuration>
					</plugin>
				</plugins>
			</build>
		</profile>
		<profile>
			<id>springboot-profile</id>
			<properties>
				<packaging.type>jar</packaging.type>
				<log.appender>CONSOLE</log.appender>
			</properties>
			<dependencyManagement>
				<dependencies>
					<dependency>
						<groupId>org.springframework.boot</groupId>
						<artifactId>spring-boot-starter-tomcat</artifactId>
						<version>2.2.4.RELEASE</version>
						<scope>compile</scope>
					</dependency>
				</dependencies>
			</dependencyManagement>
			<build>
				<plugins>
					<plugin>
						<groupId>org.springframework.boot</groupId>
						<artifactId>spring-boot-maven-plugin</artifactId>
						<configuration>
							<mainClass>${main.class}</mainClass>
						</configuration>
					</plugin>
					<plugin>
						<groupId>com.google.code.maven-replacer-plugin</groupId>
						<artifactId>replacer</artifactId>
						<executions>
							<execution>
								<id>replace-in-config</id>
								<phase>prepare-package</phase>
								<goals>
									<goal>replace</goal>
								</goals>
							</execution>
							<execution>
								<id>replace-in-classes</id>
								<phase>prepare-package</phase>
								<goals>
									<goal>replace</goal>
								</goals>
							</execution>
						</executions>
					</plugin>
				</plugins>
			</build>
		</profile>
	</profiles>
	<build>
		<!-- PLUGIN MANAGEMENT -->
		<pluginManagement>
			<plugins>
				<plugin>
					<artifactId>maven-war-plugin</artifactId>
					<version>${maven-war-plugin.version}</version>
					<configuration>
						<failOnMissingWebXml>false</failOnMissingWebXml>
						<archive>
							<addMavenDescriptor>false</addMavenDescriptor>
							<manifestEntries>
								<Implementation-Build>${buildNumber}</Implementation-Build>
								<Implementation-Timestamp>${timestamp}</Implementation-Timestamp>
								<Implementation-FormatedTimestamp>${formatedTimestamp}</Implementation-FormatedTimestamp>
								<Implementation-Version>${project.version}</Implementation-Version>
								<Implementation-Title>${project.artifactId}</Implementation-Title>
								<Implementation-Vendor-Id>${project.groupId}</Implementation-Vendor-Id>
								<Main-Class>${start-class}</Main-Class>
							</manifestEntries>
						</archive>
					</configuration>
				</plugin>
				<plugin>
					<artifactId>maven-deploy-plugin</artifactId>
					<configuration>
						<skip>false</skip>
					</configuration>
				</plugin>
				<plugin>
					<artifactId>maven-release-plugin</artifactId>
					<version>${maven-release-plugin.version}</version>
					<configuration>
						<goals>deploy -Prelease-profile</goals>
						<releaseProfiles>release-profile</releaseProfiles>
					</configuration>
				</plugin>
				<plugin>
					<groupId>org.codehaus.mojo</groupId>
					<artifactId>buildnumber-maven-plugin</artifactId>
					<version>1.4</version>
					<executions>
						<execution>
							<id>formattedTimestamp-exec</id>
							<phase>validate</phase>
							<goals>
								<goal>create</goal>
							</goals>
							<configuration>
								<buildNumberPropertyName>formatedTimestamp</buildNumberPropertyName>
								<format>{0,date,dd.MM.yyyy HH:mm:ss}</format>
								<items>
									<item>timestamp</item>
								</items>
							</configuration>
						</execution>
						<execution>
							<id>zipnameTimestamp-exec</id>
							<phase>validate</phase>
							<goals>
								<goal>create</goal>
							</goals>
							<configuration>
								<buildNumberPropertyName>zipnameTimestamp</buildNumberPropertyName>
								<format>{0,date,yyyyMMdd-HHmmss}</format>
								<items>
									<item>timestamp</item>
								</items>
							</configuration>
						</execution>
						<execution>
							<id>buildNumber-exec</id>
							<phase>validate</phase>
							<goals>
								<goal>create</goal>
							</goals>
							<configuration>
								<shortRevisionLength>8</shortRevisionLength>
							</configuration>
						</execution>
					</executions>
				</plugin>
				<!-- JACOCO PLUGIN FOR REPORTS -->
				<plugin>
					<groupId>org.jacoco</groupId>
					<artifactId>jacoco-maven-plugin</artifactId>
					<version>0.7.7.201606060606</version>
					<configuration>
						<!--<propertyName>jacoco.agent.argLine</propertyName>-->
						<excludes>
							<exclude>**/entities/**/*.class</exclude>
						</excludes>
					</configuration>
					<executions>
						<execution>
							<goals>
								<goal>prepare-agent</goal>
							</goals>
						</execution>
						<execution>
							<id>report</id>
							<phase>prepare-package</phase>
							<goals>
								<goal>report</goal>
							</goals>
						</execution>
					</executions>
				</plugin>
				<!-- IT TESTS -->
				<plugin>
					<groupId>org.apache.maven.plugins</groupId>
					<artifactId>maven-failsafe-plugin</artifactId>
					<version>${maven-failsafe-plugin.version}</version>
					<goals>
						<goal>integration-test</goal>
						<goal>verify</goal>
					</goals>
					<configuration>
						<reportsDirectory>${project.build.directory}/surefire-reports</reportsDirectory>
						<argLine>${jacoco.agent.argLine}</argLine>
					</configuration>
				</plugin>
				<!-- TESTS -->
				<plugin>
					<groupId>org.apache.maven.plugins</groupId>
					<artifactId>maven-surefire-plugin</artifactId>
					<version>${maven-surefire-plugin.version}</version>
					<configuration>
						<includes>
							<include>**/*Test.java</include>
							<include>**/*Tests.java</include>
							<include>**/*TestCase.java</include>
						</includes>
					</configuration>
				</plugin>
			</plugins>
		</pluginManagement>
	</build>
</project>
