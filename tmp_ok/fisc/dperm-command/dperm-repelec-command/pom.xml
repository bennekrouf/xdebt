<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">

	<modelVersion>4.0.0</modelVersion>

	<artifactId>dperm-repelec-command</artifactId>
	<packaging>war</packaging>

	<description>Microservice permettant l'écriture de documents dans Repelec. Tout ajout doit passer par ce composant
	</description>

	<parent>
		<groupId>ch.vd.fiscalite.dperm</groupId>
		<artifactId>dperm-repelec</artifactId>
		<version>24R2.B.1-SNAPSHOT</version>
	</parent>

	<properties>
		<!-- use UTF-8 for everything -->
		<start-class>ch.vd.fiscalite.dperm.repelec.command.Boot</start-class>

		<xfile.url>http://exploitation.etat-de-vaud.ch/outils/web/ws/rest</xfile.url>
		<assembly.env>TBD</assembly.env>
		<assembly.finalName>${project.artifactId}-${project.version}</assembly.finalName>

		<!-- Paramètres -->
		<jvm.mem.params>-Xmx1024</jvm.mem.params>

		<!-- Parametres de testing -->
		<surefire.useFile>false</surefire.useFile>
		<failsafe.useFile>false</failsafe.useFile>
		<skipTests>false</skipTests>
	</properties>

	<dependencies>
		<dependency>
			<groupId>ch.vd.fiscalite.shared</groupId>
			<artifactId>monitoring-tools</artifactId>
		</dependency>
		<dependency>
			<groupId>ch.vd.fiscalite.dperm</groupId>
			<artifactId>dperm-repelec-api</artifactId>
		</dependency>
		<dependency>
			<groupId>ch.vd.fiscalite.dperm</groupId>
			<artifactId>dperm-repelec-impl-indexation</artifactId>
		</dependency>
		<dependency>
			<groupId>ch.vd.fiscalite.dperm</groupId>
			<artifactId>dperm-repelec-impl-indexationdocument</artifactId>
		</dependency>
		<dependency>
			<groupId>ch.vd.fiscalite.dperm</groupId>
			<artifactId>dperm-repelec-impl-archivage</artifactId>
		</dependency>
		<dependency>
			<groupId>ch.vd.fiscalite.dperm</groupId>
			<artifactId>dperm-repelec-impl-documentsortant</artifactId>
		</dependency>
		<dependency>
			<groupId>ch.vd.fiscalite.dperm</groupId>
			<artifactId>dperm-repelec-impl-agregation</artifactId>
		</dependency>
		<dependency>
			<groupId>ch.vd.fiscalite.dperm</groupId>
			<artifactId>dperm-repelec-impl-integration</artifactId>
		</dependency>
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-jta-atomikos</artifactId>
		</dependency>
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-security</artifactId>
		</dependency>
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-web</artifactId>
			<exclusions>
				<exclusion>
					<groupId>org.springframework.boot</groupId>
					<artifactId>spring-boot-starter-tomcat</artifactId>
				</exclusion>
			</exclusions>
		</dependency>
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-tomcat</artifactId>
			<scope>provided</scope>
		</dependency>
		<dependency>
			<groupId>org.springframework</groupId>
			<artifactId>spring-oxm</artifactId>
		</dependency>
		<dependency>
			<groupId>javax.servlet</groupId>
			<artifactId>javax.servlet-api</artifactId>
			<scope>provided</scope>
		</dependency>
		<dependency>
			<groupId>org.apache.activemq</groupId>
			<artifactId>activemq-client</artifactId>
		</dependency>
		<dependency>
			<groupId>org.apache.activemq</groupId>
			<artifactId>activemq-ra</artifactId>
		</dependency>
		<dependency>
			<groupId>org.apache.activemq</groupId>
			<artifactId>activemq-pool</artifactId>
		</dependency>
		<dependency>
			<groupId>xml-apis</groupId>
			<artifactId>xml-apis</artifactId>
		</dependency>
		<dependency>
			<groupId>org.glassfish.jersey.ext</groupId>
			<artifactId>jersey-spring5</artifactId>
		</dependency>
		<dependency>
			<groupId>oracle.jdbc</groupId>
			<artifactId>ojdbc7</artifactId>
			<scope>runtime</scope>
		</dependency>

		<!-- shared vd.ch -->
		<dependency>
			<groupId>ch.vd.registre</groupId>
			<artifactId>shared-base</artifactId>
		</dependency>
		<dependency>
			<groupId>ch.vd.shared</groupId>
			<artifactId>shared-hibernate</artifactId>
		</dependency>
		<dependency>
			<groupId>ch.vd.fiscalite.shared</groupId>
			<artifactId>shared-fisc-jmx</artifactId>
		</dependency>
		<dependency>
			<groupId>ch.vd.registre</groupId>
			<artifactId>shared-jmx-atomikos</artifactId>
		</dependency>

		<dependency>
			<groupId>org.apache.commons</groupId>
			<artifactId>commons-lang3</artifactId>
		</dependency>

		<!-- Deps de test -->
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-test</artifactId>
			<scope>test</scope>
			<exclusions>
				<exclusion>
					<groupId>org.junit.vintage</groupId>
					<artifactId>junit-vintage-engine</artifactId>
				</exclusion>
			</exclusions>
		</dependency>
		<dependency>
			<groupId>ch.vd.shared</groupId>
			<artifactId>shared-testing</artifactId>
			<scope>test</scope>
			<exclusions>
				<exclusion>
					<groupId>log4j</groupId>
					<artifactId>log4j</artifactId>
				</exclusion>
			</exclusions>
		</dependency>
		<dependency>
			<groupId>com.h2database</groupId>
			<artifactId>h2</artifactId>
			<scope>test</scope>
		</dependency>
		<!-- https://mvnrepository.com/artifact/org.dbunit/dbunit -->
		<dependency>
			<groupId>org.dbunit</groupId>
			<artifactId>dbunit</artifactId>
			<scope>test</scope>
		</dependency>
	</dependencies>

	<build>
		<pluginManagement>
			<plugins>
				<plugin>
					<artifactId>maven-surefire-plugin</artifactId>
					<version>${maven-surefire-plugin.version}</version>
					<configuration>
						<includes>
							<include>**/*Test.java</include>
						</includes>
						<excludes>
							<exclude>**/*IT.java</exclude>
						</excludes>
					</configuration>
				</plugin>
				<plugin>
					<artifactId>maven-compiler-plugin</artifactId>
					<version>${maven-compiler-plugin.version}</version>
					<configuration>
						<encoding>UTF-8</encoding>
						<release>11</release>
						<source>${maven.compiler.source}</source>
						<target>${maven.compiler.target}</target>
						<showDeprecation>true</showDeprecation>
					</configuration>
				</plugin>
				<plugin>
					<artifactId>maven-jar-plugin</artifactId>
				</plugin>
				<plugin>
					<artifactId>maven-source-plugin</artifactId>
				</plugin>
				<plugin>
					<artifactId>maven-deploy-plugin</artifactId>
					<version>${maven-deploy-plugin.version}</version>
					<configuration>
						<!-- On ne veut pas que le release plugin envoie le résultat dans Nexus mais dans xFile -->
						<skip>false</skip>
					</configuration>
				</plugin>
				<plugin>
					<artifactId>maven-assembly-plugin</artifactId>
					<executions>
						<execution>
							<id>build-delivery-cei</id>
							<phase>package</phase>
							<configuration>
								<descriptors>
									<descriptor>src/main/assembly/assembly.xml</descriptor>
								</descriptors>
								<finalName>${assembly.finalName}</finalName>
								<appendAssemblyId>false</appendAssemblyId>
								<tarLongFileMode>posix</tarLongFileMode>
							</configuration>
						</execution>
					</executions>
				</plugin>
				<plugin>
					<groupId>cei.aew.web</groupId>
					<artifactId>cei-maven-plugin</artifactId>
					<executions>
						<execution>
							<id>upload-delivery-cei</id>
							<phase>package</phase>
							<goals>
								<goal>upload</goal>
							</goals>
							<configuration>
								<webresourceurl>${xfile.url}</webresourceurl>
								<filetoupload>target/${assembly.finalName}.tar.gz</filetoupload>
								<from>xsijme</from>
								<to>WEB</to>
							</configuration>
						</execution>
					</executions>
				</plugin>

			</plugins>
		</pluginManagement>

		<plugins>
			<plugin>
				<groupId>org.codehaus.mojo</groupId>
				<artifactId>buildnumber-maven-plugin</artifactId>
			</plugin>
			<plugin>
				<artifactId>maven-jar-plugin</artifactId>
				<version>${maven-jar-plugin.version}</version>
				<executions>
					<execution>
						<goals>
							<goal>test-jar</goal>
						</goals>
						<phase>verify</phase>
					</execution>
				</executions>
			</plugin>
			<plugin>
				<artifactId>maven-source-plugin</artifactId>
				<version>${maven-source-plugin.version}</version>
				<executions>
					<execution>
						<goals>
							<goal>jar</goal>
						</goals>
						<phase>verify</phase>
					</execution>
				</executions>
			</plugin>
		</plugins>
		<resources>
			<resource>
				<directory>src/main/resources</directory>
				<excludes>
					<exclude>version.txt</exclude>
				</excludes>
				<filtering>false</filtering>
			</resource>
			<resource>
				<directory>src/main/resources</directory>
				<includes>
					<include>version.txt</include>
				</includes>
				<filtering>true</filtering>
			</resource>
		</resources>
		<testResources>
			<testResource>
				<directory>src/test/resources</directory>
				<filtering>false</filtering>
			</testResource>
		</testResources>
	</build>

	<profiles>
		<profile>
			<id>not</id>
			<!-- NOTests -->
			<properties>
				<skipTests>true</skipTests>
			</properties>
		</profile>
		<profile>
			<id>xfile.va</id>
			<properties>
				<xfile.url>http://exploitation-va.etat-de-vaud.ch/outils/web/ws/rest</xfile.url>
			</properties>
		</profile>
		<profile>
			<!-- pour le déploiement en IN -->
			<id>env.in</id>
			<properties>
				<assembly.createdeploy>true</assembly.createdeploy>
				<assembly.env>IN</assembly.env>
			</properties>
			<build>
				<plugins>
					<!-- Pour générer le fichier pour le CEI -->
					<plugin>
						<artifactId>maven-assembly-plugin</artifactId>
						<version>${maven-assembly-plugin.version}</version>
						<executions>
							<execution>
								<id>build-delivery-cei</id>
								<goals>
									<goal>single</goal>
								</goals>
							</execution>
						</executions>
					</plugin>
				</plugins>
			</build>
		</profile>
		<profile>
			<!-- Pour faire la livraison au CEI dans xFile -->
			<id>env.cei</id>
			<properties>
				<assembly.createdeploy>true</assembly.createdeploy>
				<assembly.env>CEI</assembly.env>
			</properties>
			<build>
				<plugins>
					<!-- Pour générer le fichier pour le CEI -->
					<plugin>
						<artifactId>maven-assembly-plugin</artifactId>
						<version>${maven-assembly-plugin.version}</version>
						<executions>
							<execution>
								<id>build-delivery-cei</id>
								<goals>
									<goal>single</goal>
								</goals>
							</execution>
						</executions>
					</plugin>
					<plugin>
						<groupId>cei.aew.web</groupId>
						<artifactId>cei-maven-plugin</artifactId>
						<version>${cei-maven-plugin.version}</version>
						<executions>
							<execution>
								<id>upload-delivery-cei</id>
								<goals>
									<goal>upload</goal>
								</goals>
							</execution>
						</executions>
					</plugin>
				</plugins>
			</build>
		</profile>
		<profile>
			<id>webit</id>
			<build>
				<plugins>
					<plugin>
						<groupId>org.apache.maven.plugins</groupId>
						<artifactId>maven-failsafe-plugin</artifactId>
						<version>${maven-failsafe-plugin.version}</version>
						<configuration>
							<skipTests>false</skipTests>
							<includes>
								<include>**/*IT.java</include>
							</includes>
							<excludes>
								<exclude>**/*Test.java</exclude>
							</excludes>
						</configuration>
						<executions>
							<execution>
								<id>it</id>
								<phase>integration-test</phase>
								<goals>
									<goal>integration-test</goal>
									<goal>verify</goal>
								</goals>
							</execution>
						</executions>
					</plugin>
				</plugins>
			</build>
		</profile>
	</profiles>

</project>
