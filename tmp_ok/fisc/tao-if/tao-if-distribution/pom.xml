<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">

    <!-- ###### PARENT ###### -->
    <parent>
        <groupId>ch.vd.dfin.tao.tao-if</groupId>
        <artifactId>tao-if-app</artifactId>
        <version>24R2.0.3.3-SNAPSHOT</version>
    </parent>

    <!-- ###### INFORMATIONS ###### -->

    <modelVersion>4.0.0</modelVersion>
    <artifactId>tao-if</artifactId>
    <packaging>pom</packaging>
    <name>tao-if-distribution</name>
    <description>Librairie Web TAO IF : Spring-boot, Hibernate, shared-iam, AngularJS, bootstrap Usabilis
    </description>

    <properties>
        <!-- Distribution -->
        <application.version>${project.version}</application.version>
        <application.buildTime>${maven.build.timestamp}</application.buildTime>
        <devex.deployEnv>IN</devex.deployEnv>
        <devex.deployTarget>Tomcat9RHEL9</devex.deployTarget>
        <devex.configTag>master</devex.configTag>
    </properties>

    <build>
        <pluginManagement>
            <plugins>
                <!-- The Assembly Plugin for Maven is primarily intended to allow users to aggregate the project output along with its dependencies, modules, site documentation, and other files into a single distributable archive -->
                <plugin>
                    <artifactId>maven-assembly-plugin</artifactId>
                    <executions>
                        <execution>
                            <id>assembly-release</id>
                            <phase>none</phase>
                            <configuration>
                                <appendAssemblyId>false</appendAssemblyId>
                                <finalName>${dist.app.name}</finalName>
                                <descriptors>
                                    <descriptor>${basedir}/src/main/assembly/tao-if-release.xml</descriptor>
                                </descriptors>
                            </configuration>
                        </execution>
                    </executions>
                </plugin>
            </plugins>
        </pluginManagement>

        <plugins>
            <plugin>
                <artifactId>maven-assembly-plugin</artifactId>
                <executions>
                    <execution>
                        <id>assembly-release</id>
                        <phase>package</phase>
                        <goals>
                            <goal>single</goal>
                        </goals>
                    </execution>
                </executions>
            </plugin>
        </plugins>
    </build>

    <profiles>
        <profile>
            <id>build-delivery-devex</id>
            <build>
                <plugins>
                    <plugin>
                        <artifactId>maven-assembly-plugin</artifactId>
                        <executions>
                            <execution>
                                <id>assembly-release</id>
                            </execution>
                        </executions>
                    </plugin>
                </plugins>
            </build>
        </profile>

        <!-- Création de la release dans devex -->
        <profile>
            <!-- pour l'utilisation du plugin devex : les varaible d'environnement doivent être setter : déjà effectué sur jenkins
              DEVEX_URL=http://outils-devex-ws.etat-de-vaud.ch/outils/devex
              DEVEX_USERNAME=< IUP>
              DEVEX_PASSWORD=<pwd ADACV>
            -->
            <id>devex.release</id>
            <build>
                <plugins>
                    <plugin>
                        <artifactId>maven-deploy-plugin</artifactId>
                        <configuration>
                            <skip>false</skip>
                        </configuration>
                    </plugin>
                    <plugin>
                        <groupId>ch.vd.devex</groupId>
                        <artifactId>devex-maven-plugin</artifactId>
                        <version>${devex-maven-plugin.version}</version>
                        <configuration>
                            <deployTarget>${devex.deployTarget}</deployTarget>
                            <configTag>${devex.configTag}</configTag>
                            <deployUnit>tao-if</deployUnit>
                        </configuration>
                        <executions>
                            <execution>
                                <id>release</id>
                                <phase>install</phase>
                                <goals>
                                    <goal>create-release</goal>
                                </goals>
                            </execution>
                        </executions>
                    </plugin>
                </plugins>
            </build>
        </profile>

        <!-- Déploiment de la release dans devex -->
        <profile>
            <!-- pour l'utilisation du plugin devex : les varaible d'environnement doivent être setter : déjà effectué sur jenkins
              DEVEX_URL=http://outils-devex-ws.etat-de-vaud.ch/outils/devex
              DEVEX_USERNAME=< IUP>
              DEVEX_PASSWORD=<pwd ADACV>
            -->
            <id>devex.in</id>
            <build>
                <plugins>
                    <plugin>
                        <groupId>ch.vd.devex</groupId>
                        <artifactId>devex-maven-plugin</artifactId>
                        <version>${devex-maven-plugin.version}</version>
                        <configuration>
                            <deployTarget>${devex.deployTarget}</deployTarget>
                            <configTag>${devex.configTag}</configTag>
                            <deployUnit>tao-if</deployUnit>
                            <environment>${devex.deployEnv}</environment>
                            <releaseVersion>${project.version}</releaseVersion>
                        </configuration>
                        <executions>
                            <execution>
                                <id>deploy</id>
                                <phase>deploy</phase>
                                <goals>
                                    <goal>deploy</goal>
                                </goals>
                            </execution>
                        </executions>
                    </plugin>
                </plugins>
            </build>
        </profile>
    </profiles>
</project>
