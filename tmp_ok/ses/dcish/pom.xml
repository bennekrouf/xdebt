<?xml version="1.0" encoding="UTF-8"?><project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>
    <parent>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-parent</artifactId>
        <version>2.7.18</version>
        <relativePath /> <!-- lookup parent from repository -->
    </parent>
    <groupId>ch.vd.ses</groupId>
    <artifactId>dcish</artifactId>
    <version>2.3.2-SNAPSHOT</version>
    <name>dcish</name>
    <packaging>jar</packaging>

    <description>DCISH</description>
     <scm>
        <developerConnection>scm:git:git@bitbucket.etat-de-vaud.ch::/ses/dcish</developerConnection>
        <tag>2.2.8</tag>
    </scm>

    <properties>
        <assembly.finalName>${project.artifactId}-${project.version}</assembly.finalName>

        <buildnumber-maven-plugin.version>1.4</buildnumber-maven-plugin.version>

        <java.version>11</java.version>
        <guava.version>33.0.0-jre</guava.version>
        <okhttp3.version>4.12.0</okhttp3.version>

        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
        <project.reporting.outputEncoding>UTF-8</project.reporting.outputEncoding>

        <lombok.encoding>UTF-8</lombok.encoding>
        <commons-io.version>2.15.1</commons-io.version>

        <!-- Testing & reports -->
        <skip.integration.tests>false</skip.integration.tests>
        <skip.unit.tests>false</skip.unit.tests>
        <skipTests>false</skipTests>
        <surefire.useFile>false</surefire.useFile>

        <!-- maven release plugin configuration for applications -->
        <maven-release-plugin.version>3.0.1</maven-release-plugin.version>
        <release.goals>clean deploy</release.goals>
        <release.profiles>not,assembly,angular,nexus,${devex.profiles}</release.profiles>
        <release.pushChanges>true</release.pushChanges>
        <maven-assembly-plugin.version>3.1.1</maven-assembly-plugin.version>
        <application.repository>jenkinsses</application.repository>

        <!-- DevEx -->
        <devex-maven-plugin.version>1.0.19</devex-maven-plugin.version>
        <devex-maven-plugin.configTag>2.1.29</devex-maven-plugin.configTag>
        <devex.profiles>devex.release,devex.in</devex.profiles>
        <devex.releaseVersion>${project.version}</devex.releaseVersion>
        <devex.deployUnit>${project.artifactId}</devex.deployUnit>

        <executable.finalName>${project.artifactId}</executable.finalName>
        <atomikos.version>5.0.87</atomikos.version>
        <iam-spring-boot-starter.version>1.6.11</iam-spring-boot-starter.version>

        <!-- front build configuration -->
        <exec-maven-plugin.workingDirectory.front>${basedir}/front</exec-maven-plugin.workingDirectory.front>

        <yarn.executable>yarn</yarn.executable>

        <target.classes>target/classes</target.classes>
        <target.classes.publicOrStatic>public</target.classes.publicOrStatic>
        <static.final.outputDirectory>static</static.final.outputDirectory>
        <front.dist>front/dist</front.dist>
        <front.dist.package.outputDirectory>package</front.dist.package.outputDirectory>
        <front.dist.static.outputDirectory>static</front.dist.static.outputDirectory>

        <angular.test.argument>test:ci</angular.test.argument>
        <angular.lint.argument>lint</angular.lint.argument>
        <angular.buildprod.argument>build:prod</angular.buildprod.argument>
        <!-- Sonar -->
        <sonar.sources>pom.xml,src/main,front/src</sonar.sources>
        <sonar.tests>front/src</sonar.tests>
        <sonar.javascript.lcov.reportPaths>front/coverage/lcov.info</sonar.javascript.lcov.reportPaths>
        <sonar.test.inclusions>src/test/groovy/**/*,src/test/java/**/*,front/src/**/*.spec.ts</sonar.test.inclusions>
        <sonar.coverage.exclusions>
            front/src/environments/environment*.ts,
            front/src/**/*.module.ts,
            front/src/**/*.stub.ts,
        </sonar.coverage.exclusions>
        <sonar.exclusions>
            front/node_modules/,
            front/src/polyfills.ts,
            front/src/test.ts,
            front/src/main.ts,
        </sonar.exclusions>
    </properties>

    <dependencies>
        <dependency>
            <groupId>ch.vd.iam</groupId>
            <artifactId>iam-spring-boot-starter</artifactId>
            <version>${iam-spring-boot-starter.version}</version>
            <exclusions>
                <exclusion>
                    <groupId>ch.vd.shared</groupId>
                    <artifactId>shared-iam</artifactId>
                </exclusion>
            </exclusions>
        </dependency>
        <dependency>
            <groupId>ch.vd.shared</groupId>
            <artifactId>shared-iam</artifactId>
            <version>7.0.6</version>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-jta-atomikos</artifactId>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-actuator</artifactId>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-data-jpa</artifactId>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-data-rest</artifactId>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-security</artifactId>
        </dependency>
        <dependency>
            <groupId>commons-io</groupId>
            <artifactId>commons-io</artifactId>
            <version>${commons-io.version}</version>
        </dependency>
        <dependency>
            <groupId>com.h2database</groupId>
            <artifactId>h2</artifactId>
            <scope>runtime</scope>
        </dependency>
        <dependency>
            <groupId>com.oracle.database.jdbc</groupId>
            <artifactId>ojdbc11</artifactId>
            <scope>runtime</scope>
        </dependency>
        <dependency>
            <groupId>org.projectlombok</groupId>
            <artifactId>lombok</artifactId>
            <optional>true</optional>
        </dependency>
        <dependency>
            <groupId>org.mapstruct</groupId>
            <artifactId>mapstruct</artifactId>
            <version>1.5.3.Final</version>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-test</artifactId>
            <scope>test</scope>
        </dependency>
        <dependency>
            <groupId>commons-beanutils</groupId>
            <artifactId>commons-beanutils</artifactId>
            <version>1.9.4</version>
            <exclusions>
                <exclusion>
                    <groupId>commons-logging</groupId>
                    <artifactId>commons-logging</artifactId>
                </exclusion>
            </exclusions>
        </dependency>
        <!-- Add this be sure that commons-beanutils  does not crash-->
        <dependency>
            <groupId>org.slf4j</groupId>
            <artifactId>jcl-over-slf4j</artifactId>
            <version>1.7.30</version>
        </dependency>
        <dependency>
            <groupId>org.apache.poi</groupId>
            <artifactId>poi</artifactId>
            <version>5.2.3</version>
        </dependency>
        <dependency>
            <groupId>org.apache.poi</groupId>
            <artifactId>poi-ooxml</artifactId>
            <version>5.2.3</version>
        </dependency>
        <!-- Utilities -->
        <dependency>
            <groupId>com.google.guava</groupId>
            <artifactId>guava</artifactId>
            <version>${guava.version}</version>
        </dependency>
        <!-- Alfresco api call -->
        <dependency>
            <groupId>ch.vd.dsi.ses</groupId>
            <artifactId>alfresco-rest</artifactId>
            <version>1.0.6</version>
        </dependency>
    </dependencies>


    <build>
        <finalName>${executable.finalName}</finalName>
        <plugins>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-enforcer-plugin</artifactId>
                <version>3.0.0-M3</version>
                <executions>
                    <execution>
                        <id>enforce-maven</id>
                        <goals>
                            <goal>enforce</goal>
                        </goals>
                        <configuration>
                            <rules>
                                <requireMavenVersion>
                                    <version>3.0.5</version>
                                </requireMavenVersion>
                            </rules>
                        </configuration>
                    </execution>
                </executions>
            </plugin>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-compiler-plugin</artifactId>
                <version>3.8.1</version>
                <configuration>
                    <release>11</release>
                    <annotationProcessorPaths>
                        <path>
                            <groupId>org.mapstruct</groupId>
                            <artifactId>mapstruct-processor</artifactId>
                            <version>1.5.3.Final</version>
                        </path>
                        <path>
                            <groupId>org.projectlombok</groupId>
                            <artifactId>lombok-mapstruct-binding</artifactId>
                            <version>0.2.0</version>
                        </path>
                        <path>
                            <groupId>org.projectlombok</groupId>
                            <artifactId>lombok</artifactId>
                            <version>1.18.26</version>
                        </path>
                    </annotationProcessorPaths>
                </configuration>
            </plugin>
            <plugin>
                <groupId>org.codehaus.mojo</groupId>
                <artifactId>versions-maven-plugin</artifactId>
                <configuration>
                    <generateBackupPoms>false</generateBackupPoms>
                </configuration>
            </plugin>
            <plugin>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-maven-plugin</artifactId>
                <configuration>
                    <jvmArguments>
                        -Dch.vd.configDir=${project.basedir}/appDir/INT/config -Dport.http=8080 -Dch.vd.deployDir=${project.basedir}/appDir -Doracle.jdbc.fanEnabled=false
                    </jvmArguments>
                </configuration>
                <executions>
                    <execution>
                        <goals>
                            <goal>build-info</goal>
                        </goals>
                    </execution>
                </executions>
            </plugin>
            <!-- Pour le build angular -->
            <plugin>
                <groupId>org.codehaus.mojo</groupId>
                <artifactId>exec-maven-plugin</artifactId>
                <version>1.6.0</version>
                <configuration>
                    <workingDirectory>front</workingDirectory>
                </configuration>
                <executions>
                    <execution>
                        <id>exec-npm-version</id>
                        <phase>prepare-package</phase>
                        <configuration>
                            <executable>npm</executable>
                            <arguments>
                                <argument>--version</argument>
                            </arguments>
                        </configuration>
                        <goals>
                            <goal>exec</goal>
                        </goals>
                    </execution>
                    <execution>
                        <id>exec-npm-install</id>
                        <phase>prepare-package</phase>
                        <configuration>
                            <executable>npm</executable>
                            <arguments>
                                <argument>install</argument>
                                <argument>--no-audit</argument>
                            </arguments>
                        </configuration>
                        <goals>
                            <goal>exec</goal>
                        </goals>
                    </execution>
                    <execution>
                        <id>exec-npm-build</id>
                        <phase>prepare-package</phase>
                        <configuration>
                            <executable>npm</executable>
                            <arguments>
                                <argument>run</argument>
                                <argument>build</argument>
                            </arguments>
                        </configuration>
                        <goals>
                            <goal>exec</goal>
                        </goals>
                    </execution>
                </executions>
            </plugin>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-release-plugin</artifactId>
                <version>${maven-release-plugin.version}</version>
                <configuration>
                    <scmShallowClone>false</scmShallowClone>
                    <goals>${release.goals}</goals>
                    <releaseProfiles>${release.profiles}</releaseProfiles>
                    <tagNameFormat>@{project.version}</tagNameFormat>
                    <arguments>-Dmaven.javadoc.skip=true</arguments>
                    <pushChanges>${release.pushChanges}</pushChanges>
                    <checkModificationExcludes>
                        <checkModificationExclude>front/package-lock.json</checkModificationExclude>
                    </checkModificationExcludes>
                </configuration>
            </plugin>
            <plugin>
                <groupId>org.codehaus.mojo</groupId>
                <artifactId>buildnumber-maven-plugin</artifactId>
                <version>${buildnumber-maven-plugin.version}</version>
                <executions>
                    <execution>
                        <phase>validate</phase>
                        <goals>
                            <goal>create-timestamp</goal>
                        </goals>
                    </execution>
                </executions>
            </plugin>
            <!-- force jacoc to do xml report for sonar analysis -->
            <plugin>
                <groupId>org.jacoco</groupId>
                <artifactId>jacoco-maven-plugin</artifactId>
                <version>0.8.7</version>
                <executions>
                    <execution>
                        <id>prepare-agent</id>
                        <goals>
                            <goal>prepare-agent</goal>
                        </goals>
                    </execution>
                    <execution>
                        <id>report</id>
                        <goals>
                            <goal>report</goal>
                        </goals>
                        <configuration>
                            <formats>
                                <format>XML</format>
                            </formats>
                        </configuration>
                    </execution>
                </executions>
            </plugin>
            <plugin>
                <groupId>com.diffplug.spotless</groupId>
                <artifactId>spotless-maven-plugin</artifactId>
                <version>2.40.0</version>
                <configuration>
                    <!-- optional: limit format enforcement to just the files changed by this feature branch -->
                    <ratchetFrom>release/2.3</ratchetFrom>
                    <formats>
                        <!-- you can define as many formats as you want, each is independent -->
                        <format>
                            <!-- define the files to apply to -->
                            <includes>
                                <include>*.md</include>
                                <include>.gitignore</include>
                            </includes>
                            <!-- define the steps to apply to those files -->
                            <trimTrailingWhitespace />
                            <endWithNewline />
                            <indent>
                                <tabs>true</tabs>
                                <spacesPerTab>4</spacesPerTab>
                            </indent>
                        </format>
                    </formats>
                    <!-- define a language-specific format -->
                    <java>
                        <removeUnusedImports />
                        
                        <googleJavaFormat>
                            <version>1.18.1</version>
                            <style>AOSP</style>
                            <reflowLongStrings>false</reflowLongStrings>
                            <formatJavadoc>false</formatJavadoc>
                        </googleJavaFormat>
                    </java>
                </configuration>
                <executions>
                    <!-- sur le jenkins dgnsi pas de deep copy du repo git on peut plus faire le check
                    <execution>
                        <id>forcecheck</id>
                        <goals>
                            <goal>check</goal>
                        </goals>
                        <phase>test</phase>
                    </execution>
                    -->
                </executions>
            </plugin>
            <plugin>
                <groupId>com.rudikershaw.gitbuildhook</groupId>
                <artifactId>git-build-hook-maven-plugin</artifactId>
                <version>3.4.1</version>
                <configuration>
                    <installHooks>
                        <pre-commit>scripts/pre-commit</pre-commit>
                    </installHooks>
                    <gitConfig>
                    </gitConfig>
                </configuration>
                <executions>
                    <execution>
                        <goals>
                            <goal>configure</goal>
                            <goal>install</goal>
                        </goals>
                    </execution>
                </executions>
            </plugin>
        </plugins>
        <pluginManagement>
            <plugins>
                <plugin>
                    <groupId>ch.vd.devex</groupId>
                    <artifactId>devex-maven-plugin</artifactId>
                    <version>${devex-maven-plugin.version}</version>
                    <configuration>
                        <configTag>${devex-maven-plugin.configTag}</configTag>
                        <releaseVersion>${devex.releaseVersion}</releaseVersion>
                        <deployUnit>${devex.deployUnit}</deployUnit>
                    </configuration>
                </plugin>
            </plugins>
        </pluginManagement>
        <resources>
            <resource>
                <directory>src/main/resources</directory>
                <excludes>
                    <exclude>version.txt</exclude>
                </excludes>
                <filtering>false</filtering>
            </resource>
            <resource>
                <directory>src/main/resources</directory>
                <includes>
                    <include>version.txt</include>
                </includes>
                <filtering>true</filtering>
            </resource>
        </resources>
    </build>
    <profiles>
        <profile>
            <!-- No Tests -->
            <id>not</id>
            <properties>
                <skipTests>true</skipTests>
                <skip.integration.tests>true</skip.integration.tests>
                <skip.unit.tests>true</skip.unit.tests>
            </properties>
        </profile>
        <profile>
            <id>assembly</id>
            <build>
                <plugins>
                    <plugin>
                        <groupId>org.springframework.boot</groupId>
                        <artifactId>spring-boot-maven-plugin</artifactId>
                        <version>2.4.13</version>
                        <executions>
                            <execution>
                                <id>repackage</id>
                                <configuration>
                                    <executable>true</executable>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-assembly-plugin</artifactId>
                        <version>${maven-assembly-plugin.version}</version>
                        <executions>
                            <execution>
                                <phase>package</phase>
                                <goals>
                                    <goal>single</goal>
                                </goals>
                            </execution>
                        </executions>
                        <configuration>
                            <descriptors>
                                <descriptor>assembly.xml</descriptor>
                            </descriptors>
                            <finalName>${assembly.finalName}</finalName>
                            <appendAssemblyId>false</appendAssemblyId>
                            <tarLongFileMode>warn</tarLongFileMode>
                        </configuration>
                    </plugin>
                </plugins>
            </build>
        </profile>
         <profile>
            <id>nexus</id>
            <properties>
                <release.goals>clean deploy</release.goals>
                <devex-maven-plugin.phase>deploy</devex-maven-plugin.phase>
            </properties>
            <distributionManagement>
                <repository>
                    <id>nexus-dgnsi-server</id>
                    <name>Nexus DGNSI</name>
                    <url>${nexus.url}/app-${application.repository}-stable</url>
                </repository>
                <snapshotRepository>
                    <id>nexus-dgnsi-server</id>
                    <name>Nexus DGNSI</name>
                    <url>${nexus.url}/app-${application.repository}-snapshots</url>
                    <uniqueVersion>false</uniqueVersion>
                </snapshotRepository>
            </distributionManagement>
        </profile>
        <profile>
            <id>devex.release</id>
            <build>
                <plugins>
                    <plugin>
                        <groupId>ch.vd.devex</groupId>
                        <artifactId>devex-maven-plugin</artifactId>
                        <executions>
                            <execution>
                                <id>create</id>
                                <phase>deploy</phase>
                                <goals>
                                    <goal>create-release</goal>
                                </goals>
                            </execution>
                        </executions>
                    </plugin>
                </plugins>
            </build>
        </profile>
        <profile>
            <id>devex.in</id>
            <build>
                <plugins>
                    <plugin>
                        <groupId>ch.vd.devex</groupId>
                        <artifactId>devex-maven-plugin</artifactId>
                        <executions>
                            <execution>
                                <id>deploy</id>
                                <phase>deploy</phase>
                                <goals>
                                    <goal>deploy</goal>
                                </goals>
                                <configuration>
                                    <environment>IN</environment>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                </plugins>
            </build>
        </profile>
        <profile>
            <id>platform-windows</id>
            <activation>
                <os>
                    <family>windows</family>
                </os>
            </activation>
            <properties>
                <yarn.executable>yarn.cmd</yarn.executable>
            </properties>
        </profile>
        <profile>
            <id>angular</id>
            <build>
                <plugins>
                    <plugin>
                        <groupId>org.codehaus.mojo</groupId>
                        <artifactId>exec-maven-plugin</artifactId>
                        <executions>
                            <execution>
                                <id>exec-npmi-build</id>
                                <phase>prepare-package</phase>
                                <configuration>
                                    <workingDirectory>${exec-maven-plugin.workingDirectory.front}</workingDirectory>
                                    <executable>npm</executable>
                                    <arguments>
                                        <argument>install</argument>
                                        <argument>--no-audit</argument>
                                    </arguments>
                                </configuration>
                                <goals>
                                    <goal>exec</goal>
                                </goals>
                            </execution>
                            <execution>
                                <id>exec-ngcli-tests</id>
                                <phase>prepare-package</phase>
                                <configuration>
                                    <workingDirectory>${exec-maven-plugin.workingDirectory.front}</workingDirectory>
                                    <executable>npm</executable>
                                    <arguments>
                                        <argument>${angular.test.argument}</argument>
                                    </arguments>
                                    <skip>true</skip>
                                </configuration>
                                <goals>
                                    <goal>exec</goal>
                                </goals>
                            </execution>
                            <execution>
                                <id>exec-ngcli-lint</id>
                                <phase>prepare-package</phase>
                                <configuration>
                                    <workingDirectory>${exec-maven-plugin.workingDirectory.front}</workingDirectory>
                                    <executable>npm</executable>
                                    <arguments>
                                        <argument>run</argument>
                                        <argument>${angular.lint.argument}</argument>
                                    </arguments>
                                    <skip>${skipTests}</skip>
                                </configuration>
                                <goals>
                                    <goal>exec</goal>
                                </goals>
                            </execution>
                            <execution>
                                <id>exec-ngcli-build</id>
                                <phase>prepare-package</phase>
                                <configuration>
                                    <workingDirectory>${exec-maven-plugin.workingDirectory.front}</workingDirectory>
                                    <executable>npm</executable>
                                    <arguments>
                                        <argument>run</argument>
                                        <argument>${angular.buildprod.argument}</argument>
                                    </arguments>
                                </configuration>
                                <goals>
                                    <goal>exec</goal>
                                </goals>
                            </execution>
                        </executions>
                    </plugin>
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-resources-plugin</artifactId>
                        <configuration>
                            <encoding>${project.build.sourceEncoding}</encoding>
                        </configuration>
                        <executions>
                            <execution>
                                <id>exec-copy-noindex-noassets</id>
                                <phase>prepare-package</phase>
                                <goals>
                                    <goal>copy-resources</goal>
                                </goals>
                                <configuration>
                                    <outputDirectory>
                                        ${basedir}/${target.classes}/${target.classes.publicOrStatic}/${static.final.outputDirectory}
                                    </outputDirectory>
                                    <resources>
                                        <resource>
                                            <directory>${front.dist}/${front.dist.package.outputDirectory}</directory>
                                            <filtering>false</filtering>
                                            <excludes>
                                                <exclude>index.html</exclude>
                                                <include>${front.dist.static.outputDirectory}/**/*.*</include>
                                            </excludes>
                                        </resource>
                                    </resources>
                                </configuration>
                            </execution>
                            <execution>
                                <id>exec-copy-index-assets</id>
                                <phase>prepare-package</phase>
                                <goals>
                                    <goal>copy-resources</goal>
                                </goals>
                                <configuration>
                                    <outputDirectory>${basedir}/${target.classes}/${target.classes.publicOrStatic}
                                    </outputDirectory>
                                    <resources>
                                        <resource>
                                            <directory>${front.dist}/${front.dist.package.outputDirectory}</directory>
                                            <filtering>false</filtering>
                                            <includes>
                                                <include>index.html</include>
                                                <include>${front.dist.static.outputDirectory}/**/*.*</include>
                                            </includes>
                                        </resource>
                                    </resources>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                </plugins>
            </build>
        </profile>
    </profiles>
    <repositories>
        <repository>
            <id>local-maven-repo</id>
            <url>file:///${project.basedir}/lib</url>
        </repository>
    </repositories>

</project>
