<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <parent>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-parent</artifactId>
        <version>2.7.18</version>
    </parent>

    <groupId>ch.vd.formation.lagapep</groupId>
    <artifactId>lagapep-root</artifactId>
    <version>13.7.0-SNAPSHOT</version>
    <packaging>pom</packaging>

    <name>Lagapep - Root</name>
    <description>Root module of Lagapep</description>

    <scm>
        <developerConnection>${scm.connexion}</developerConnection>
        <url>${scm.connexion}</url>
        <tag>HEAD</tag>
    </scm>

    <modules>
        <module>app</module>
        <module>app-core</module>

        <module>alfresco-core</module>
        <module>aspose-core</module>
        <module>editique-core</module>
        <module>esb-core</module>
        <module>security-core</module>
        <module>tracing-core</module>
        <module>notification-core</module>

        <module>document-generation</module>
        <module>document-generation-integration</module>
        <module>document-store</module>
        <module>document-store-integration</module>

        <module>etablissement</module>
        <module>etablissement-integration</module>
        <module>entreprise</module>
        <module>entreprise-integration</module>
        <module>person</module>
        <module>person-integration</module>
        <module>profession</module>
        <module>profession-integration</module>
        <module>template-document</module>
        <module>template-document-integration</module>
        <module>territory</module>
        <module>territory-integration</module>
        <module>user</module>
        <module>user-integration</module>
        <module>indicator</module>
        <module>indicator-integration</module>
        <module>bdfa2-core</module>
        <module>bdfa2-core-integration</module>
    </modules>

    <properties>
        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>

        <java.version>11</java.version>

        <apache.commons-compress.version>1.26.1</apache.commons-compress.version>
        <esb-client.version>5.5.4</esb-client.version>
        <guava.version>32.1.0-jre</guava.version>
        <google.libphonenumber.version>8.13.21</google.libphonenumber.version>
        <apache.poi.version>5.2.3</apache.poi.version>
        <apache.commons-text.version>1.10.0</apache.commons-text.version>
        <mockito-inline>3.10.0</mockito-inline>
        <hazelcast.version>5.3.6</hazelcast.version>
        <atomikos.version>5.0.108</atomikos.version>
        <tika.version>2.4.1</tika.version>
        <liquibase.version>4.21.1</liquibase.version>
        <thumbnailator.version>0.4.19</thumbnailator.version>
        <aspose.version>20.9</aspose.version>
        <activemq.version>5.16.7</activemq.version>

        <lombok.version>1.18.12</lombok.version>
        <mapstruct.version>1.3.1.Final</mapstruct.version>
        <hsqldb.version>2.7.2</hsqldb.version>
        <snakeyaml.version>2.0</snakeyaml.version>
        <commons-io.version>2.13.0</commons-io.version>
        <tomcat.version>9.0.90</tomcat.version>
        <netty.version>4.1.108.Final</netty.version>
        <jackson-bom.version>2.15.4</jackson-bom.version>
        <spring-framework.version>5.3.39</spring-framework.version>
        <spring-security.version>5.7.12</spring-security.version>
        <logback.version>1.2.13</logback.version>
        <json-path.version>2.9.0</json-path.version>

        <!-- ACV/DGNSI - DevEx build properties -->
        <devex-maven-plugin.deployTarget>EmbeddedRHEL8</devex-maven-plugin.deployTarget>
        <devex-maven-plugin.configTag>13.8.0</devex-maven-plugin.configTag>
        <devex-maven-plugin.deployUnit>lagapep</devex-maven-plugin.deployUnit>
        <devex-maven-plugin.releaseVersion>${project.version}</devex-maven-plugin.releaseVersion>
        <devex-maven-plugin.version>2.0.0</devex-maven-plugin.version>
        <devex-maven-plugin.warProjectOnly>false</devex-maven-plugin.warProjectOnly>
        <devex.profiles>devex.release,devex.in</devex.profiles>
        <release.goals>clean deploy</release.goals>
        <release.profiles>DGNSI,not,nexus,${devex.profiles}</release.profiles>
        <release.pushChanges>true</release.pushChanges>
        <maven.deploy.skip>true</maven.deploy.skip>

        <surefire.argLine>-Duser.language=en -Duser.region=US</surefire.argLine>

        <!-- Sonar -->
        <sonar.coverage.exclusions>
            **/generated-sources/**,**/integration/**,**/adapter/api/**,**/adapter/event/**,**/adapter/service/**,**/adapter/repository/**,**/*Application.java,**/*Configuration.java,**/*Exception*.java
        </sonar.coverage.exclusions>

        <sonar.cpd.exclusions>
            **/*AuditData*.java,**/*Validator.java,**/*Mapper.java,**/*Entity.java,**/domain/model/**,**/*PermissionEvaluator.java,**/*RestResponseEntityExceptionHandler.java
        </sonar.cpd.exclusions>

        <sonar.issue.ignore.multicriteria>e1,e2,e3,e4,e5,e6,e7,e8,e9,e10,e11,e12,e13,e14</sonar.issue.ignore.multicriteria>

        <sonar.issue.ignore.multicriteria.e1.ruleKey>java:S4603</sonar.issue.ignore.multicriteria.e1.ruleKey>
        <sonar.issue.ignore.multicriteria.e1.resourceKey>**/src/**/*</sonar.issue.ignore.multicriteria.e1.resourceKey>

        <sonar.issue.ignore.multicriteria.e2.ruleKey>java:S4604</sonar.issue.ignore.multicriteria.e2.ruleKey>
        <sonar.issue.ignore.multicriteria.e2.resourceKey>**/src/**/*</sonar.issue.ignore.multicriteria.e2.resourceKey>

        <sonar.issue.ignore.multicriteria.e3.ruleKey>java:S4605</sonar.issue.ignore.multicriteria.e3.ruleKey>
        <sonar.issue.ignore.multicriteria.e3.resourceKey>**/src/**/*</sonar.issue.ignore.multicriteria.e3.resourceKey>

        <sonar.issue.ignore.multicriteria.e4.ruleKey>java:S1130</sonar.issue.ignore.multicriteria.e4.ruleKey>
        <sonar.issue.ignore.multicriteria.e4.resourceKey>**/src/**/*</sonar.issue.ignore.multicriteria.e4.resourceKey>

        <sonar.issue.ignore.multicriteria.e5.ruleKey>java:S2698</sonar.issue.ignore.multicriteria.e5.ruleKey>
        <sonar.issue.ignore.multicriteria.e5.resourceKey>**/src/**/*</sonar.issue.ignore.multicriteria.e5.resourceKey>

        <sonar.issue.ignore.multicriteria.e6.ruleKey>java:S1166</sonar.issue.ignore.multicriteria.e6.ruleKey>
        <sonar.issue.ignore.multicriteria.e6.resourceKey>**/src/**/*</sonar.issue.ignore.multicriteria.e6.resourceKey>

        <sonar.issue.ignore.multicriteria.e7.ruleKey>java:S923</sonar.issue.ignore.multicriteria.e7.ruleKey>
        <sonar.issue.ignore.multicriteria.e7.resourceKey>**/src/**/*</sonar.issue.ignore.multicriteria.e7.resourceKey>

        <sonar.issue.ignore.multicriteria.e8.ruleKey>java:S3749</sonar.issue.ignore.multicriteria.e8.ruleKey>
        <sonar.issue.ignore.multicriteria.e8.resourceKey>**/src/**/*</sonar.issue.ignore.multicriteria.e8.resourceKey>

        <sonar.issue.ignore.multicriteria.e9.ruleKey>java:S107</sonar.issue.ignore.multicriteria.e9.ruleKey>
        <sonar.issue.ignore.multicriteria.e9.resourceKey>**/src/**/*</sonar.issue.ignore.multicriteria.e9.resourceKey>

        <sonar.issue.ignore.multicriteria.e10.ruleKey>java:S110</sonar.issue.ignore.multicriteria.e10.ruleKey>
        <sonar.issue.ignore.multicriteria.e10.resourceKey>**/src/**/*</sonar.issue.ignore.multicriteria.e10.resourceKey>

        <!-- empty curley braces is NOT a major issue -->
        <sonar.issue.ignore.multicriteria.e11.ruleKey>java:S1602</sonar.issue.ignore.multicriteria.e11.ruleKey>
        <sonar.issue.ignore.multicriteria.e11.resourceKey>**/src/**/*</sonar.issue.ignore.multicriteria.e11.resourceKey>

        <!-- Remove java:S100 in entity repository class because of spring data naming convention -->
        <sonar.issue.ignore.multicriteria.e12.ruleKey>java:S100</sonar.issue.ignore.multicriteria.e12.ruleKey>
        <sonar.issue.ignore.multicriteria.e12.resourceKey>**/src/**/*Entity*.java</sonar.issue.ignore.multicriteria.e12.resourceKey>

        <!-- Remove java:S4276 for developer discretion to use the correct Functional interface (sometime the primitive type is not enough) -->
        <sonar.issue.ignore.multicriteria.e13.ruleKey>java:S4276</sonar.issue.ignore.multicriteria.e13.ruleKey>
        <sonar.issue.ignore.multicriteria.e13.resourceKey>**/src/**/*</sonar.issue.ignore.multicriteria.e13.resourceKey>

        <!-- Remove java:S5961 to allow more assertions in test file as our model/dto can be large-->
        <sonar.issue.ignore.multicriteria.e14.ruleKey>java:S5961</sonar.issue.ignore.multicriteria.e14.ruleKey>
        <sonar.issue.ignore.multicriteria.e14.resourceKey>**/src/**/*Test.java</sonar.issue.ignore.multicriteria.e14.resourceKey>

        <scm.connexion>scm:git:ssh://git@bitbucket.etat-de-vaud.ch/formation/lagapep.git</scm.connexion>
    </properties>

    <dependencyManagement>
        <dependencies>
            <!-- Spring Cloud Dependencies -->
            <dependency>
                <groupId>org.springframework.cloud</groupId>
                <artifactId>spring-cloud-dependencies</artifactId>
                <version>2021.0.9</version>
                <type>pom</type>
                <scope>import</scope>
            </dependency>

            <dependency>
                <groupId>org.springframework.security</groupId>
                <artifactId>spring-security-rsa</artifactId>
                <version>1.1.3</version>
            </dependency>

            <!-- ACV/DGNSI - ESB -->
            <dependency>
                <groupId>ch.vd.technical.esb</groupId>
                <artifactId>esb-client</artifactId>
                <version>${esb-client.version}</version>
            </dependency>
            <dependency>
                <groupId>ch.vd.technical.esb</groupId>
                <artifactId>esb-validation</artifactId>
                <version>${esb-client.version}</version>
            </dependency>

            <!-- Atomikos -->
            <dependency>
                <groupId>com.atomikos</groupId>
                <artifactId>transactions-spring-boot-starter</artifactId>
                <version>${atomikos.version}</version>
            </dependency>

            <!-- Helpers -->
            <dependency>
                <groupId>com.google.guava</groupId>
                <artifactId>guava</artifactId>
                <version>${guava.version}</version>
            </dependency>
            <dependency>
                <groupId>com.googlecode.libphonenumber</groupId>
                <artifactId>libphonenumber</artifactId>
                <version>${google.libphonenumber.version}</version>
            </dependency>
            <dependency>
                <groupId>org.mapstruct</groupId>
                <artifactId>mapstruct</artifactId>
                <version>${mapstruct.version}</version>
            </dependency>
            <dependency>
                <groupId>org.mapstruct</groupId>
                <artifactId>mapstruct-processor</artifactId>
                <version>${mapstruct.version}</version>
            </dependency>
            <dependency>
                <groupId>org.apache.poi</groupId>
                <artifactId>poi</artifactId>
                <version>${apache.poi.version}</version>
            </dependency>
            <dependency>
                <groupId>org.apache.poi</groupId>
                <artifactId>poi-ooxml</artifactId>
                <version>${apache.poi.version}</version>
            </dependency>

            <!-- Swagger -->
            <dependency>
                <groupId>io.swagger</groupId>
                <artifactId>swagger-annotations</artifactId>
                <version>1.6.9</version>
            </dependency>
            <dependency>
                <groupId>org.openapitools</groupId>
                <artifactId>jackson-databind-nullable</artifactId>
                <version>0.2.4</version>
            </dependency>

            <!-- Utils -->
            <dependency>
                <groupId>commons-io</groupId>
                <artifactId>commons-io</artifactId>
                <version>${commons-io.version}</version>
            </dependency>
            <dependency>
                <groupId>org.apache.commons</groupId>
                <artifactId>commons-text</artifactId>
                <version>${apache.commons-text.version}</version>
            </dependency>
        </dependencies>
    </dependencyManagement>

    <dependencies>
        <!-- Tests -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-test</artifactId>
            <scope>test</scope>
        </dependency>
        <dependency>
            <groupId>org.springframework.security</groupId>
            <artifactId>spring-security-test</artifactId>
            <scope>test</scope>
        </dependency>
        <dependency>
            <groupId>org.junit.vintage</groupId>
            <artifactId>junit-vintage-engine</artifactId>
            <scope>test</scope>
        </dependency>
    </dependencies>

    <repositories>
        <repository>
            <id>project-release</id>
            <url>https://artifactory.svc.elca.ch/artifactory/prj_lagapep_release/</url>
            <releases>
                <enabled>true</enabled>
            </releases>
            <snapshots>
                <enabled>false</enabled>
            </snapshots>
        </repository>
        <repository>
            <id>project-snapshot</id>
            <url>https://artifactory.svc.elca.ch/artifactory/prj_lagapep_snapshot/</url>
            <releases>
                <enabled>false</enabled>
            </releases>
            <snapshots>
                <enabled>true</enabled>
            </snapshots>
        </repository>
    </repositories>

    <profiles>
        <profile>
            <id>DGNSI</id>
            <activation>
                <activeByDefault>true</activeByDefault>
            </activation>
            <modules>
                <module>front</module>
            </modules>
            <properties>
                <springActiveProfiles>default,production</springActiveProfiles>

                <!-- ACV/DGNSI - Sonar build properties -->
                <sonar.dynamicAnalysis>reuseReports</sonar.dynamicAnalysis>
                <sonar.java.coveragePlugin>jacoco</sonar.java.coveragePlugin>
                <sonar.dependencyCheck.jsonReportPath>${project.build.directory}/dependency-check-report.json
                </sonar.dependencyCheck.jsonReportPath>
                <sonar.dependencyCheck.htmlReportPath>${project.build.directory}/dependency-check-report.html
                </sonar.dependencyCheck.htmlReportPath>
            </properties>
            <distributionManagement>
                <repository>
                    <id>nexus.releases</id>
                    <name>Nexus releases</name>
                    <url>${nexus.url.stable}</url>
                </repository>
                <snapshotRepository>
                    <id>nexus.snapshots</id>
                    <name>Nexus snapshots</name>
                    <url>${nexus.url.snapshots}</url>
                    <uniqueVersion>false</uniqueVersion>
                </snapshotRepository>
            </distributionManagement>
            <build>
                <pluginManagement>
                    <plugins>
                        <plugin>
                            <groupId>ch.vd.devex</groupId>
                            <artifactId>devex-maven-plugin</artifactId>
                            <version>${devex-maven-plugin.version}</version>
                            <configuration>
                                <deployTarget>${devex-maven-plugin.deployTarget}</deployTarget>
                                <configTag>${devex-maven-plugin.configTag}</configTag>
                                <deployUnit>${devex-maven-plugin.deployUnit}</deployUnit>
                                <releaseVersion>${devex-maven-plugin.releaseVersion}</releaseVersion>
                                <warProjectOnly>${devex-maven-plugin.warProjectOnly}</warProjectOnly>
                            </configuration>
                        </plugin>
                    </plugins>
                </pluginManagement>
                <plugins>
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-release-plugin</artifactId>
                        <configuration>
                            <goals>${release.goals}</goals>
                            <pushChanges>${release.pushChanges}</pushChanges>
                            <releaseProfiles>${release.profiles}</releaseProfiles>
                            <tagNameFormat>@{project.version}</tagNameFormat>
                        </configuration>
                    </plugin>
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-source-plugin</artifactId>
                        <executions>
                            <execution>
                                <id>attach-sources</id>
                                <goals>
                                    <goal>jar-no-fork</goal>
                                </goals>
                                <phase>verify</phase>
                            </execution>
                        </executions>
                    </plugin>
                    <plugin>
                        <groupId>org.jacoco</groupId>
                        <artifactId>jacoco-maven-plugin</artifactId>
                        <executions>
                            <execution>
                                <goals>
                                    <goal>prepare-agent</goal>
                                </goals>
                                <configuration>
                                    <propertyName>surefire.argLine</propertyName>
                                </configuration>
                            </execution>
                            <execution>
                                <id>report</id>
                                <phase>prepare-package</phase>
                                <goals>
                                    <goal>report</goal>
                                </goals>
                            </execution>
                        </executions>
                    </plugin>
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-surefire-plugin</artifactId>
                        <configuration>
                            <argLine>@{surefire.argLine}</argLine>
                        </configuration>
                    </plugin>
                </plugins>
            </build>
        </profile>
        <profile>
            <id>owasp-dependency-check</id>
            <build>
                <plugins>
                    <plugin>
                        <groupId>org.owasp</groupId>
                        <artifactId>dependency-check-maven</artifactId>
                        <version>7.4.4</version>
                        <inherited>false</inherited>
                        <executions>
                            <execution>
                                <goals>
                                    <goal>aggregate</goal>
                                </goals>
                            </execution>
                        </executions>
                        <configuration>
                            <formats>
                                <format>json</format>
                                <format>html</format>
                            </formats>
                        </configuration>
                    </plugin>
                </plugins>
            </build>
        </profile>
        <profile>
            <id>ELCA</id>
            <properties>
                <springActiveProfiles>default</springActiveProfiles>
                <devex-maven-plugin.deployUnit>lagapep</devex-maven-plugin.deployUnit>
                <scm.connexion>ssh://git@bitbucket.svc.elca.ch:7999/lagapep/be.git</scm.connexion>
            </properties>
            <distributionManagement>
                <repository>
                    <id>project-release</id>
                    <url>https://artifactory.svc.elca.ch/artifactory/prj_lagapep_release</url>
                    <uniqueVersion>true</uniqueVersion>
                </repository>
                <snapshotRepository>
                    <id>project-snapshot</id>
                    <url>https://artifactory.svc.elca.ch/artifactory/prj_lagapep_snapshot</url>
                    <uniqueVersion>false</uniqueVersion>
                </snapshotRepository>
            </distributionManagement>
        </profile>
        <profile>
            <id>Local</id>
            <properties>
                <springActiveProfiles>default,local</springActiveProfiles>
            </properties>
            <distributionManagement>
                <repository>
                    <id>project-release</id>
                    <url>https://artifactory.svc.elca.ch/artifactory/prj_lagapep_release</url>
                    <uniqueVersion>true</uniqueVersion>
                </repository>
                <snapshotRepository>
                    <id>project-snapshot</id>
                    <url>https://artifactory.svc.elca.ch/artifactory/prj_lagapep_snapshot</url>
                    <uniqueVersion>false</uniqueVersion>
                </snapshotRepository>
            </distributionManagement>
        </profile>
        <profile>
            <id>nof</id>
            <properties>
                <build.nofront>true</build.nofront>
                <skipTests>true</skipTests>
            </properties>
        </profile>
        <profile>
            <id>not</id>
            <properties>
                <skipTests>true</skipTests>
            </properties>
        </profile>
        <profile>
            <id>no.snapshot</id>
            <build>
                <plugins>
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-enforcer-plugin</artifactId>
                    </plugin>
                </plugins>
            </build>
        </profile>
    </profiles>

    <build>
        <pluginManagement>
            <plugins>
                <plugin>
                    <groupId>org.jacoco</groupId>
                    <artifactId>jacoco-maven-plugin</artifactId>
                    <version>0.8.10</version>
                </plugin>
                <plugin>
                    <groupId>org.apache.maven.plugins</groupId>
                    <artifactId>maven-surefire-plugin</artifactId>
                    <version>2.22.2</version>
                </plugin>
            </plugins>
        </pluginManagement>
        <plugins>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-compiler-plugin</artifactId>
                <configuration>
                    <source>${java.version}</source>
                    <target>${java.version}</target>
                </configuration>
            </plugin>
            <plugin>
                <groupId>org.jacoco</groupId>
                <artifactId>jacoco-maven-plugin</artifactId>
                <executions>
                    <execution>
                        <goals>
                            <goal>prepare-agent</goal>
                        </goals>
                    </execution>
                    <execution>
                        <id>report</id>
                        <phase>prepare-package</phase>
                        <goals>
                            <goal>report</goal>
                        </goals>
                    </execution>
                </executions>
            </plugin>
        </plugins>
    </build>
</project>