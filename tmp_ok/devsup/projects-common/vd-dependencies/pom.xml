<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">

    <modelVersion>4.0.0</modelVersion>

    <groupId>ch.vd.devsupport</groupId>
    <artifactId>vd-dependencies</artifactId>
    <version>2.3.6-SNAPSHOT</version>
    <packaging>pom</packaging>

    <name>DEVSUPPORT - Dependencies Parent</name>

    <parent>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-parent</artifactId>
        <version>3.3.4</version>
        <relativePath />
    </parent>

    <profiles>
        <profile>
            <id>not</id>
            <properties>
                <skipTests>true</skipTests>
            </properties>
        </profile>
        <profile>
            <id>no.snapshot</id>
            <build>
                <plugins>
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-enforcer-plugin</artifactId>
                    </plugin>
                </plugins>
            </build>
        </profile>
    </profiles>

    <dependencyManagement>
        <dependencies>
            <dependency>
                <groupId>ch.vd.shared</groupId>
                <artifactId>shared-iam</artifactId>
                <version>${shared-iam.version}</version>
            </dependency>
            <dependency>
                <groupId>ch.vd.technical.esb</groupId>
                <artifactId>esb-client-spring-boot-starter</artifactId>
                <version>${esb-client-spring-boot-starter.version}</version>
                <!-- unneeded, and not native compliant -->
                <exclusions>
                    <exclusion>
                        <groupId>commons-logging</groupId>
                        <artifactId>commons-logging</artifactId>
                    </exclusion>
                </exclusions>
            </dependency>
            <dependency>
                <groupId>com.atomikos</groupId>
                <artifactId>transactions-spring-boot3-starter</artifactId>
                <version>${transactions-spring-boot3-starter.version}</version>
            </dependency>
            <dependency>
                <groupId>commons-io</groupId>
                <artifactId>commons-io</artifactId>
                <version>${commons-io.version}</version>
            </dependency>
            <dependency>
                <groupId>org.postgresql</groupId>
                <artifactId>postgresql</artifactId>
                <version>${postgresql.version}</version>
            </dependency>
            <dependency>
                <groupId>com.oracle.database.jdbc</groupId>
                <artifactId>ojdbc10</artifactId>
                <version>${ojdbc10.version}</version>
                <exclusions>
                    <exclusion>
                        <groupId>com.oracle.database.ha</groupId>
                        <artifactId>simplefan</artifactId>
                    </exclusion>
                    <exclusion>
                        <groupId>com.oracle.database.ha</groupId>
                        <artifactId>ons</artifactId>
                    </exclusion>
                </exclusions>
            </dependency>
            <dependency>
                <groupId>com.oracle.database.jdbc</groupId>
                <artifactId>ojdbc11</artifactId>
                <version>${ojdbc11.version}</version>
            </dependency>
            <dependency>
                <groupId>org.springdoc</groupId>
                <artifactId>springdoc-openapi-starter-webmvc-ui</artifactId>
                <version>${springdoc-openapi-starter-webmvc-ui.version}</version>
            </dependency>
        </dependencies>
    </dependencyManagement>

    <build>
        <pluginManagement>
            <plugins>
                <plugin>
                    <groupId>org.springframework.boot</groupId>
                    <artifactId>spring-boot-maven-plugin</artifactId>
                    <executions>
                        <execution>
                            <id>repackage</id>
                            <configuration>
                                <executable>${spring-boot-maven-plugin.executable}</executable>
                            </configuration>
                        </execution>
                    </executions>
                </plugin>
                <plugin>
                    <groupId>org.apache.maven.plugins</groupId>
                    <artifactId>maven-release-plugin</artifactId>
                    <version>${maven-release-plugin.version}</version>
                    <configuration>
                        <goals>${release.goals}</goals>
                        <releaseProfiles>${release.profiles}</releaseProfiles>
                        <tagNameFormat>@{project.version}</tagNameFormat>
                        <pushChanges>${release.pushChanges}</pushChanges>
                        <localCheckout>true</localCheckout>
                        <autoVersionSubmodules>true</autoVersionSubmodules>
                    </configuration>
                </plugin>
                <plugin>
                    <groupId>org.apache.maven.plugins</groupId>
                    <artifactId>maven-source-plugin</artifactId>
                    <executions>
                        <execution>
                            <id>attach-sources</id>
                            <goals>
                                <goal>jar-no-fork</goal>
                            </goals>
                            <phase>verify</phase>
                        </execution>
                    </executions>
                </plugin>
                <plugin>
                    <groupId>org.apache.maven.plugins</groupId>
                    <artifactId>maven-enforcer-plugin</artifactId>
                    <executions>
                        <execution>
                            <id>enforce-no-snapshots</id>
                            <goals>
                                <goal>enforce</goal>
                            </goals>
                            <configuration>
                                <rules>
                                    <requireReleaseDeps>
                                        <message>No Snapshots Allowed!</message>
                                    </requireReleaseDeps>
                                </rules>
                                <fail>true</fail>
                            </configuration>
                        </execution>
                        <execution>
                            <id>ban-bad-log4j-versions</id>
                            <phase>validate</phase>
                            <goals>
                                <goal>enforce</goal>
                            </goals>
                            <configuration>
                                <rules>
                                    <bannedDependencies>
                                        <excludes>
                                            <exclude>org.apache.logging.log4j:log4j-core:(,2.17.0)</exclude>
                                        </excludes>
                                    </bannedDependencies>
                                </rules>
                                <fail>true</fail>
                            </configuration>
                        </execution>
                    </executions>
                </plugin>
                <plugin>
                    <groupId>org.codehaus.mojo</groupId>
                    <artifactId>buildnumber-maven-plugin</artifactId>
                    <version>${buildnumber-maven-plugin.version}</version>
                </plugin>
                <plugin>
                    <groupId>org.jacoco</groupId>
                    <artifactId>jacoco-maven-plugin</artifactId>
                    <version>${jacoco-maven-plugin.version}</version>
                    <configuration>
                        <skip>${skipTests}</skip>
                    </configuration>
                    <executions>
                        <execution>
                            <id>prepare-agent</id>
                            <goals>
                                <goal>prepare-agent</goal>
                            </goals>
                        </execution>
                        <execution>
                            <id>report</id>
                            <goals>
                                <goal>report</goal>
                            </goals>
                            <phase>verify</phase>
                        </execution>
                    </executions>
                </plugin>
                <plugin>
                    <groupId>ch.vd.devex</groupId>
                    <artifactId>devex-maven-plugin</artifactId>
                    <version>${devex-maven-plugin.version}</version>
                    <configuration>
                        <configTag>${devex-maven-plugin.configTag}</configTag>
                        <releaseVersion>${devex-maven-plugin.releaseVersion}</releaseVersion>
                        <deployUnit>${devex-maven-plugin.deployUnit}</deployUnit>
                        <deployTarget>${devex-maven-plugin.deployTarget}</deployTarget>
                        <warProjectOnly>${devex-maven-plugin.warProjectOnly}</warProjectOnly>
                    </configuration>
                </plugin>
                <plugin>
                    <groupId>ch.vd.devsupport</groupId>
                    <artifactId>tesserakt-maven-plugin</artifactId>
                    <version>${t6kt-maven-plugin.version}</version>
                    <configuration>
                        <username>${T6KT_USERNAME}</username>
                        <password>${T6KT_PASSWORD}</password>
                        <application>${t6kt-maven-plugin.application}</application>
                        <deployUnit>${t6kt-maven-plugin.deployUnit}</deployUnit>
                        <applicationVersion>${t6kt-maven-plugin.applicationVersion}</applicationVersion>
                        <chartVersion>${t6kt-maven-plugin.chartVersion}</chartVersion>
                        <configurationVersion>${t6kt-maven-plugin.configurationVersion}</configurationVersion>
                        <environment>${t6kt-maven-plugin.environment}</environment>
                        <url>${tesserakt-maven-plugin.url}</url>
                        <cluster>${t6kt-maven-plugin.cluster}</cluster>
                    </configuration>
                </plugin>
                <plugin>
                    <groupId>org.apache.maven.plugins</groupId>
                    <artifactId>maven-checkstyle-plugin</artifactId>
                    <version>${maven-checkstyle-plugin.version}</version>
                    <executions>
                        <execution>
                            <id>validate</id>
                            <phase>validate</phase>
                            <configuration>
                                <skip>${skipTests}</skip>
                                <configLocation>${maven-checkstyle-plugin.configLocation}</configLocation>
                                <consoleOutput>true</consoleOutput>
                                <failsOnError>true</failsOnError>
                            </configuration>
                            <goals>
                                <goal>check</goal>
                            </goals>
                        </execution>
                    </executions>
                    <dependencies>
                        <dependency>
                            <groupId>com.puppycrawl.tools</groupId>
                            <artifactId>checkstyle</artifactId>
                            <version>${checkstyle.version}</version>
                        </dependency>
                    </dependencies>
                </plugin>
                <plugin>
                    <groupId>org.jetbrains.kotlin</groupId>
                    <artifactId>kotlin-maven-plugin</artifactId>
                    <configuration>
                        <args>
                            <arg>-Xjsr305=strict</arg>
                        </args>
                        <compilerPlugins>
                            <plugin>spring</plugin>
                        </compilerPlugins>
                    </configuration>
                    <dependencies>
                        <dependency>
                            <groupId>org.jetbrains.kotlin</groupId>
                            <artifactId>kotlin-maven-allopen</artifactId>
                            <version>${kotlin.version}</version>
                        </dependency>
                    </dependencies>
                </plugin>
                <plugin>
                    <groupId>org.codehaus.mojo</groupId>
                    <artifactId>exec-maven-plugin</artifactId>
                    <version>${exec-maven-plugin.version}</version>
                </plugin>
                <plugin>
                    <groupId>org.sonarsource.scanner.maven</groupId>
                    <artifactId>sonar-maven-plugin</artifactId>
                    <version>${sonar-maven-plugin.version}</version>
                </plugin>
            </plugins>
        </pluginManagement>
    </build>

    <distributionManagement>
        <repository>
            <id>nexus-dgnsi-server</id>
            <name>Nexus DGNSI</name>
            <url>${nexus.url.stable}</url>
        </repository>
        <snapshotRepository>
            <id>nexus-dgnsi-server</id>
            <name>Nexus DGNSI</name>
            <url>${nexus.url.snapshots}</url>
            <uniqueVersion>false</uniqueVersion>
        </snapshotRepository>
    </distributionManagement>

    <properties>
        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
        <project.reporting.outputEncoding>UTF-8</project.reporting.outputEncoding>
        <java.version>21</java.version>
        <maven.deploy.skip>false</maven.deploy.skip>

        <!-- Parametres de testing -->
        <surefire.useFile>false</surefire.useFile>
        <skipTests>false</skipTests>

        <atomikos.version>6.0.109</atomikos.version>
        <buildnumber-maven-plugin.version>3.2.0</buildnumber-maven-plugin.version>
        <checkstyle.version>10.15.0</checkstyle.version>
        <commons-io.version>2.16.1</commons-io.version>
        <devex-maven-plugin.version>2.0.0</devex-maven-plugin.version>
        <esb-client-spring-boot-starter.version>6.0.1</esb-client-spring-boot-starter.version>
        <exec-maven-plugin.version>3.2.0</exec-maven-plugin.version>
        <jacoco-maven-plugin.version>0.8.12</jacoco-maven-plugin.version>
        <kotlin.version>1.9.25</kotlin.version>
        <maven-checkstyle-plugin.version>3.3.1</maven-checkstyle-plugin.version>
        <maven-checkstyle-plugin.configLocation>checkstyle-rules.xml</maven-checkstyle-plugin.configLocation>
        <maven-release-plugin.version>3.1.0</maven-release-plugin.version>
        <ojdbc10.version>19.22.0.0</ojdbc10.version>
        <ojdbc11.version>23.3.0.23.09</ojdbc11.version>
        <postgresql.version>42.7.3</postgresql.version>
        <shared-iam.version>12.1.5</shared-iam.version>
        <sonar-maven-plugin.version>3.11.0.3922</sonar-maven-plugin.version>
        <springdoc-openapi-starter-webmvc-ui.version>2.6.0</springdoc-openapi-starter-webmvc-ui.version>
        <t6kt-maven-plugin.version>1.0.8</t6kt-maven-plugin.version>
        <transactions-spring-boot3-starter.version>${atomikos.version}</transactions-spring-boot3-starter.version>

        <!-- maven release plugin default configuration -->
        <release.goals>deploy</release.goals>
        <!-- we keep this as is for BC concerns, althought it's now overrdidden in most *devsup* pipeline -->
        <!-- some projects may rely on the fact that perform skip tests-->
        <release.profiles>not,no.snapshot</release.profiles>
        <release.pushChanges>false</release.pushChanges>

        <!-- devex maven plugin configuration -->
        <warProjectOnly>false</warProjectOnly>
        <devex-maven-plugin.releaseVersion>${project.version}</devex-maven-plugin.releaseVersion>
        <devex-maven-plugin.deployUnit>${project.artifactId}</devex-maven-plugin.deployUnit>
        <devex-maven-plugin.deployTarget />
        <devex-maven-plugin.configTag>master</devex-maven-plugin.configTag>
        <devex-maven-plugin.warProjectOnly>${warProjectOnly}</devex-maven-plugin.warProjectOnly>

        <!-- tesserakt maven plugin configuration -->
        <t6kt-maven-plugin.application>${project.artifactId}</t6kt-maven-plugin.application>
        <t6kt-maven-plugin.deployUnit>${project.artifactId}</t6kt-maven-plugin.deployUnit>
        <t6kt-maven-plugin.applicationVersion>${project.version}</t6kt-maven-plugin.applicationVersion>
        <t6kt-maven-plugin.chartVersion>master</t6kt-maven-plugin.chartVersion>
        <t6kt-maven-plugin.configurationVersion>master</t6kt-maven-plugin.configurationVersion>
        <t6kt-maven-plugin.environment>IN</t6kt-maven-plugin.environment>
        <t6kt-maven-plugin.cluster />
        <tesserakt-maven-plugin.url>https://esgate.etat-de-vaud.ch/tesserakt-pr</tesserakt-maven-plugin.url>

        <!-- Sonar configuration -->
        <sonar.java.coveragePlugin>jacoco</sonar.java.coveragePlugin>
        <sonar.dynamicAnalysis>reuseReports</sonar.dynamicAnalysis>

        <!-- spring boot maven plugin configuration -->
        <spring-boot-maven-plugin.executable>true</spring-boot-maven-plugin.executable>
    </properties>
</project>
